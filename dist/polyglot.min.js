"use strict";var _=require("lodash"),polyglot=module.exports={examples:[{title:"Failure of antibiotic prescribing for bacterial infections",query:'"Primary Health Care"[Mesh] OR Primary care OR Primary healthcare OR Family practice OR General practice\n\nAND\n\n"Treatment Failure"[Mesh] OR Treatment failure OR Treatment failures\n\nAND\n\n"Bacterial Infections"[Mesh] OR Bacteria OR Bacterial\n\nAND\n\n"Anti-Bacterial Agents"[Mesh] OR Antibacterial Agents OR Antibacterial Agent OR Antibiotics OR Antibiotic'},{title:"Clinical prediction guides for whiplash",query:'"Neck"[Mesh] OR Neck OR Necks OR "Cervical Vertebrae"[Mesh] OR "Cervical Vertebrae" OR "Neck Muscles"[Mesh] OR "Neck Muscles" OR "Neck Injuries"[Mesh] OR "Whiplash Injuries"[Mesh] OR "Radiculopathy"[Mesh] OR "Neck Injuries" OR "Neck Injury" OR Whiplash OR Radiculopathies OR Radiculopathy\n\n AND\n\n "Pain"[Mesh] OR Pain OR Pains OR Aches OR Ache OR Sore\n\n AND\n\n "Decision Support Techniques"[Mesh] OR "Predictive Value of Tests"[Mesh] OR "Observer Variation"[Mesh] OR Decision Support OR Decision Aids OR Decision Aid OR Decision Analysis OR Decision Modeling OR Decision modelling OR Prediction OR Predictions OR Predictor OR Predicting OR Predicted'},{title:"Prevalence of Thyroid Disease in Australia",query:'"Thyroid Diseases"[Mesh] OR "Thyroid diseases" OR "Thyroid disease" OR "Thyroid disorder" OR "Thyroid disorders" OR Goiter OR Goitre OR Hypothyroidism OR Hyperthyroidism OR Thyroiditis OR "Graves disease" OR Hyperthyroxinemia OR Thyrotoxicosis OR  "Thyroid dysgenesis" OR "Thyroid cancer" OR "Thyroid cancers" OR "Thyroid neoplasm" OR "Thyroid neoplasms" OR "Thyroid nodule" OR "Thyroid nodules" OR "Thyroid tumor" OR "Thyroid tumour" OR "Thyroid tumors" OR "Thyroid tumours" OR "Thyroid cyst" OR "Thyroid cysts" OR "Cancer of the thyroid"\n\n AND\n\n "Prevalence"[Mesh] OR "Epidemiology"[Mesh] OR "Prevalence" OR "Prevalences" OR Epidemiology OR Epidemiological\n\n AND\n\n "Australia"[Mesh] OR Australia OR Australian OR Australasian OR Australasia OR Queensland OR Victoria OR "New South Wales" OR "Northern Territory"'},{title:"Prevalence of incidental thyroid cancer: A systematic review of autopsy studies",query:'(("Thyroid Neoplasms"[Mesh] OR "Adenocarcinoma, Follicular"[Mesh] OR "Adenocarcinoma, Papillary"[Mesh] OR OPTC)) OR (((Thyroid OR Follicular OR Papillary OR hurtle cell)) AND (cancer OR cancers OR carcinoma OR carcinomas OR Adenocarcinoma OR Adenocarcinomas neoplasm OR neoplasms OR nodule OR nodules OR tumor OR tumour OR Tumors OR Tumours OR cyst OR cysts))\n\nAND\n\n"Autopsy"[Mesh] OR "Autopsy" OR "Autopsies" OR Postmortem OR Post-mortem OR (Post AND mortem)\n\nAND\n\n"Prevalence"[Mesh] OR "Epidemiology"[Mesh] OR Prevalence OR Prevalences OR Epidemiology OR Epidemiological OR Frequency\n\nAND\n\n"Incidental Findings"[Mesh] OR Incidental OR Unsuspected OR Discovery OR Discoveries OR Findings OR Finding OR Occult OR Hidden'},{title:"Positioning for acute respiratory distress in hospitalised infants and children",query:"# Lung diseases or other infections\nexp Lung Diseases/ OR exp Bronchial Diseases/ OR exp Respiratory Tract Infections/ OR exp Respiratory Insufficiency/ OR ((respir* or bronch*) adj3 (insuffic* or fail* or distress*)).tw. OR (acute lung injur* or ali).tw. OR (ards or rds).tw. OR (respiratory adj5 infect*).tw. OR (pneumon* or bronchopneumon*).tw. OR (bronchit* or bronchiolit*).tw. OR ((neonatal lung or neonatal respiratory) adj1 (diseas* or injur* or infect* or illness*)).tw. OR hyaline membrane diseas*.tw. OR bronchopulmonary dysplasia.tw. OR (croup or laryngotracheobronchit* or epiglottit* or whooping cough or legionel*).tw. OR (laryng* adj2 infect*).tw. OR (acute adj2 (episode or exacerbation*) adj3 (asthma or bronchiectasis or cystic fibrosis)).tw. OR respiratory syncytial viruses/ OR respiratory syncytial virus, human/ OR Respiratory Syncytial Virus Infections/ OR (respiratory syncytial virus* or rsv).tw.\n\nAND\n\n# Posture\nexp Posture/ OR (postur* or position*).tw. OR (supine or prone or semi-prone).tw. OR ((face or facing) adj5 down*).tw. OR (side adj5 (lay or laying or laid or lays or lying or lies)).tw. OR lateral.tw. OR upright.tw. OR (semi-recumbent or semirecumbent or semi-reclin* or semireclin* or reclin* or recumbent).tw. OR ((high or erect or non-erect or lean* or forward) adj5 (sit or sitting)).tw. OR (body adj3 tilt*).tw. OR (elevat* adj3 head*).tw.\n\nAND\n\n# RCTs\n<RCT Filter>"}],messages:{NO_SINGLE_WILDCARD:"There is no single character wildcard equievelent, so an unlimited matching length wildcard has been used instead",NO_OPTIONAL_WILDCARD:"There is no optional single character wildcard equievelent, so an unlimited matching length wildcard has been used instead"},templates:{engine:{name:"Engine name",debugging:!0,description:"The current output engine",engines:{default:"unknown",cinahl:"cinahl",cochrane:"cochrane",embase:"embase",mongodb:"mongodb",ovid:"ovid",psycinfo:"psycinfo",pubmed:"pubmed",scopus:"scopus",wos:"wos"}},"rct filter":{name:"RCT Filter",description:"Standard Cochrane RCT Filter",engines:{cinahl:'(MH "Clinical Trials+") OR (MH "Quantitative Studies") OR TI placebo* OR AB placebo* OR (MH "Placebos") OR (MH "Random Assignment") OR TI random* OR AB random* OR TI ((singl* or doubl* or tripl* or trebl*) W1 (blind* or mask*)) OR AB ((singl* or doubl* or tripl* or trebl*) W1 (blind* or mask*)) OR TI clinic* trial* OR AB clinic* trial* OR PT clinical trial',embase:"random* OR factorial OR crossover OR placebo OR blind OR blinded OR assign OR assigned OR allocate OR allocated OR 'crossover procedure'/exp OR 'double-blind procedure'/exp OR 'randomized controlled trial'/exp OR 'single-blind procedure'/exp NOT ('animal'/exp NOT ('animal'/exp AND 'human'/exp))",ovid:"((randomized controlled trial or controlled clinical trial).pt. or randomized.ab. or randomised.ab. or placebo.ab. or drug therapy.fs. or randomly.ab. or trial.ab. or groups.ab.) not (exp animals/ not humans.sh.)",psycinfo:'SU.EXACT("Treatment Effectiveness Evaluation") OR SU.EXACT.EXPLODE("Treatment Outcomes") OR SU.EXACT("Placebo") OR SU.EXACT("Followup Studies") OR placebo* OR random* OR "comparative stud*" OR  clinical NEAR/3 trial* OR research NEAR/3 design OR evaluat* NEAR/3 stud* OR prospectiv* NEAR/3 stud* OR (singl* OR doubl* OR trebl* OR tripl*) NEAR/3 (blind* OR mask*)',pubmed:'randomized controlled trial[pt] OR controlled clinical trial[pt] OR randomized[tiab] OR randomised[tiab] OR placebo[tiab] OR "drug therapy"[sh] OR randomly[tiab] OR trial[tiab] OR groups[tiab] NOT (Animals[Mesh] not (Animals[Mesh] and Humans[Mesh]))',wos:'TS=(random* or placebo* or allocat* or crossover* or "cross over" or ((singl* or doubl*) NEAR/1 blind*)) OR TI=(trial)'}},"sr filter":{name:"SR Filter",description:"Standard Cochrane SR Filter",engines:{cinahl:"TI Medline AB Medline OR TI Pubmed AB Pubmed OR (TI systematic AB systematic AND TI review AB review) OR TI meta-analysis OR AB meta-analysis",embase:"Medline:ti,ab OR Pubmed:ti,ab OR (systematic:ti,ab AND review:ti,ab) OR meta-analysis:pt OR CDSR:jt",ovid:"search:.tw.OR meta analysis.mp,pt.OR review.pt.OR di.xs. OR associated.tw.",pubmed:"search*[Title/Abstract] OR meta analysis[Publication Type] OR meta analysis[Title/Abstract] OR meta analysis[MeSH] OR review[Publication Type] OR diagnosis[MeSH Subheading] OR associated[Title/Abstract]",wos:"Medline OR Pubmed OR (systematic AND review) OR meta-analysis OR Cochrane"}}},translate:function(e,t,a){if(!polyglot.engines[t])throw new Error("Engine not found: "+t);var n=polyglot.parse(e,a);return n=polyglot.preProcess(n,a),polyglot.engines[t].compile(n,a)},translateAll:function(e,a){var n={},r=polyglot.parse(e,a);return r=polyglot.preProcess(r,a),_.forEach(polyglot.engines,function(e,t){return n[t]=e.compile(r,a)}),n},preProcess:function(e,t){_.defaults(t,{});return e},parse:function(e,t){var a,n=_.defaults(t,{groupLines:!1,groupLinesAlways:!1,removeNumbering:!0,preserveNewlines:!0,transposeLines:!0}),r=e+"",s={nodes:[]},i=[s],o=s,l=o.nodes,c=!0;if(n.transposeLines||n.groupLines||n.removeNumbering){var d=r.split("\n");if(n.transposeLines&&_(d).filter(function(e){return!/^\s*\d+(\s*\-|\s+AND|\s+OR)/i.test(e)}).map(function(e){var t=/^\s*(\d+)\.?\s(.*)$/.exec(e);if(t)return[t[1],t[2]]}).filter().mapKeys(function(e){return e[0]}).mapValues(function(e){return _.trim(e[1])}).value(),n.removeNumbering)d=d.map(function(e){return(u=/^\s*\d+\.?\s(.*)$/.exec(e))?u[1]:e});n.groupLines&&(n.groupLinesAlways||1<d.length)&&(d=d.map(function(e){return!_.trim(e)||/^\s*(and|or|not)\s*$/i.test(e)||/^\s*#/.test(e)?e:"("+e+")"})),r=d.join("\n")}function p(){l&&_.includes(["phrase","raw"],l.type)&&/ $/.test(l.content)&&(l.content=l.content.substr(0,l.content.length-1),l.content||o.nodes.pop())}for(;r.length;){var u,b=!0;if(/^\(/.test(r)){var h={type:"group",nodes:[]};o.nodes.push(h),i.push(o),l=(o=h).nodes}else if(/^\)/.test(r))a=o,o=i.pop(),l=o.nodes;else if(c&&(u=/^and\b/i.exec(r)))p(),o.nodes.push({type:"joinAnd"}),l=void 0,r=r.substr(u[0].length),b=!1;else if(c&&(u=/^or\b/i.exec(r)))p(),o.nodes.push({type:"joinOr"}),l=void 0,r=r.substr(u[0].length),b=!1;else if(c&&(u=/^not\b/i.exec(r)))p(),o.nodes.push({type:"joinNot"}),l=void 0,r=r.substr(u[0].length),b=!1;else if(c&&(u=/^(near\/|near|adj|n)(\d+)\b/i.exec(r)))p(),o.nodes.push({type:"joinNear",proximity:_.toNumber(u[2])}),l=void 0,r=r.substr(u[0].length),b=!1;else if(u=/^\[(mesh terms|mesh|mh)(:NoExp)?\]/i.exec(r))l.type="mesh",l.recurse=!u[2],/^["“”].*["“”]$/.test(l.content)&&(l.content=l.content.substr(1,l.content.length-2)),r=r.substr(u[0].length),b=!1;else if((u=/^exp "(.*?)"\/\s*/i.exec(r))||(u=/^exp (.*?)\/\s*/i.exec(r)))o.nodes.push({type:"mesh",recurse:!0,content:u[1]}),r=r.substr(u[0].length),c=!(b=!1);else if(/^\//.test(r)&&l&&l.type&&"phrase"==l.type&&!/-/.test(l.content))l.type="mesh",l.recurse=!1;else if(u=/^<(.*?)>/.exec(r))o.nodes.push({type:"template",content:u[1].toLowerCase()}),r=r.substr(u[0].length),b=!1;else if(u=/^(\n+)/.exec(r))n.preserveNewlines&&(o.nodes.push({type:"raw",content:u[0]}),l=void 0),r=r.substr(u[0].length),c=!(b=!1);else if((u=/^\.(mp)\. \[mp=.+?\]/i.exec(r))||(u=/^\.(tw|ti,ab|ab,ti|ti|ab|mp|nm|pt|fs|sh|xm)\.?/i.exec(r))||(u=/^:(tw|ti,ab|ab,ti|ti|ab|mp|nm|pt|fs|sh|xm)/i.exec(r))){var f={};switch(_.isObject(l)&&"phrase"==l.type?f=l:_.isArray(l)&&a&&(f=a),u[1].toLowerCase()){case"ti":f.field="title";break;case"ab,ti":case"ti,ab":case"tw":f.field="title+abstract";break;case"mp":f.field="title+abstract+other";break;case"ab":f.field="abstract";break;case"fs":case"sh":f.field="floatingSubheading";break;case"nm":f.field="substance";break;case"pt":f.field="publicationType";break;case"kf":f.field="author";break;case"xm":f.type="mesh",f.recurse=!0}r=r.substr(u[0].length),b=!1}else if(u=/^\[(tiab|ti|tw|ab|nm|sh|pt)\]/i.exec(r)){switch(_.isObject(l)&&"phrase"==l.type?f=l:_.isArray(l)&&a&&(f=a),u[1].toLowerCase()){case"tiab":f.field="title+abstract";break;case"tw":f.field="title+abstract+other";break;case"ti":f.field="title";break;case"ab":f.field="abstract";break;case"nm":f.field="substance";break;case"sh":f.field="floatingSubheading";break;case"pt":f.field="publicationType"}r=r.substr(u[0].length),b=!1}else if(u=/^#(.*?)[)\n]/.exec(r))p(),o.nodes.push({type:"comment",content:_.trim(u[1])}),l=void 0,r=r.substr(u[0].length),b=!1;else if(n.transposeLines&&(u=/^([0-9]+)\s*-\s*([0-9]+)(?:\/(AND|OR))?/i.exec(r)))o.nodes.push({type:"ref",ref:_.range(u[1],u[2]+1),cond:u[3]}),r=r.substr(u[0].length);else if(n.transposeLines&&(u=/^([0-9]+)\s+(AND|OR)/i.exec(r)))o.nodes.push({type:"ref",ref:[u[1]]}),r=r.substr(u[1].length);else{var m=r.substr(0,1);(_.isUndefined(l)||_.isArray(l))&&" "!=m?/^["“”]$/.test(m)&&(u=/^["“”](.*?)["“”]/.exec(r))?(l={type:"phrase",content:u[1]},o.nodes.push(l),r=r.substr(u[0].length),b=!1):(l={type:"phrase",content:m},o.nodes.push(l)):_.isObject(l)&&"phrase"==l.type&&(l.content+=m),c=" "==m}b&&(r=r.substr(1))}return n.transposeLines&&polyglot.tools.visit(s.nodes,["ref"],function(e,t){e.type="phrase",e.content="REF("+e.ref.join(",")+")"}),s.nodes},engines:{pubmed:{id:"pubmed",title:"PubMed",aliases:["pubmed","p","pm","pubm"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:"?"},{subject:/\$/g,value:"*"},{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">*</span>'}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":e.field?a+="("+n(e.nodes)+")"+("title"==e.field?"[ti]":"abstract"==e.field?"[tiab]":"title+abstract"==e.field?"[tiab]":"title+abstract+other"==e.field?"[tw]":"floatingSubheading"==e.field?"[sh]":"publicationType"==e.field?"[pt]":"substance"==e.field?"[nm]":""):a+="("+n(e.nodes)+")";break;case"phrase":e.field?a+=polyglot.tools.quotePhrase(e,"pubmed")+("title"==e.field?"[ti]":"abstract"==e.field?"[tiab]":"title+abstract"==e.field?"[tiab]":"title+abstract+other"==e.field?"[tw]":"floatingSubheading"==e.field?"[sh]":"publicationType"==e.field?"[pt]":"substance"==e.field?"[nm]":""):a+=polyglot.tools.quotePhrase(e,"pubmed");break;case"joinNear":case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"mesh":a+=polyglot.tools.quotePhrase(e,"pubmed")+"[Mesh"+(e.recurse?"":":NoExp")+"]";break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"pubmed");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"GET",action:"https://www.ncbi.nlm.nih.gov/pubmed",fields:{term:e}}},openTerms:"any search box"},ovid:{id:"ovid",title:"Ovid Medline / Ovid Embase",aliases:["ovid","o","ov"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:"?"}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":e.field?a+="("+n(e.nodes)+")"+("title"==e.field?".ti.":"abstract"==e.field?".ab.":"title+abstract"==e.field?".ti,ab.":"title+abstract+other"==e.field?".mp.":"floatingSubheading"==e.field?".fs.":"publicationType"==e.field?".pt.":"substance"==e.field?".nm.":""):a+="("+n(e.nodes)+")";break;case"phrase":e.field?a+=e.content+("title"==e.field?".ti.":"abstract"==e.field?".ab.":"title+abstract"==e.field?".ti,ab.":"title+abstract+other"==e.field?".mp.":"floatingSubheading"==e.field?".fs.":"publicationType"==e.field?".pt.":"substance"==e.field?".nm.":""):a+=e.content;break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="ADJ"+e.proximity;break;case"mesh":a+=(e.recurse?"exp ":"")+e.content+"/";break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"ovid");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://ovidsp.tx.ovid.com.ezproxy.bond.edu.au/sp-3.17.0a/ovidweb.cgi",fields:{textBox:e}}},openTerms:"any search box"},cochrane:{id:"cochrane",title:"Cochrane Library",aliases:["cochrane","c","cl"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:'<span msg="NO_OPTIONAL_WILDCARD">?</span>'},{subject:/\$/g,value:'<span msg="NO_OPTIONAL_WILDCARD">*</span>'},{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">*</span>'}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":e.field&&"floatingSubheading"==e.field?a+="[mh /"+polyglot.tools.quotePhrase(e,"cochrane")+"]":e.field?a+="("+n(e.nodes)+")"+("title"==e.field?":ti":"abstract"==e.field?":ab":"title+abstract"==e.field?":ti,ab":"title+abstract+other"==e.field?":ti,ab,kw":"publicationType"==e.field?":pt":"substance"==e.field?":kw":""):a+="("+n(e.nodes)+")";break;case"phrase":e.field&&"floatingSubheading"==e.field?a+="[mh /"+polyglot.tools.quotePhrase(e,"cochrane")+"]":e.field?a+=polyglot.tools.quotePhrase(e,"cochrane")+("title"==e.field?":ti":"abstract"==e.field?":ab":"title+abstract"==e.field?":ti,ab":"title+abstract+other"==e.field?":ti,ab,kw":"floatingSubheading"==e.field?":fs":"publicationType"==e.field?":pt":"substance"==e.field?":kw":""):a+=polyglot.tools.quotePhrase(e,"cochrane");break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="NEAR/"+e.proximity;break;case"mesh":a+="[mh "+(e.recurse?"":"^")+polyglot.tools.quotePhrase(e,"cochrane")+"]";break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"cochrane");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://onlinelibrary.wiley.com/cochranelibrary/search",fields:{submitSearch:"Go","searchRows[0].searchCriterias[0].fieldRestriction":null,"searchRows[0].searchCriterias[0].term":e,"searchRows[0].searchOptions.searchProducts":null,"searchRows[0].searchOptions.searchStatuses":null,"searchRows[0].searchOptions.searchType":"All","searchRows[0].searchOptions.publicationStartYear":null,"searchRows[0].searchOptions.publicationEndYear":null,"searchRows[0].searchOptions.disableAutoStemming":null,"searchRows[0].searchOptions.reviewGroupIds":null,"searchRows[0].searchOptions.onlinePublicationStartYear":null,"searchRows[0].searchOptions.onlinePublicationEndYear":null,"searchRows[0].searchOptions.onlinePublicationStartMonth":0,"searchRows[0].searchOptions.onlinePublicationEndMonth":0,"searchRows[0].searchOptions.dateType:pubAllYears":null,"searchRows[0].searchOptions.onlinePublicationLastNoOfMonths":0,"searchRow.ordinal":0,"hiddenFields.currentPage":1,"hiddenFields.strategySortBy":"last-modified-date;desc","hiddenFields.showStrategies":"false","hiddenFields.containerId":null,"hiddenFields.etag":null,"hiddenFields.originalContainerId":null,"hiddenFields.searchFilters.filterByProduct:cochraneReviewsDoi":null,"hiddenFields.searchFilters.filterByIssue":"all","hiddenFields.searchFilters.filterByType":"All","hiddenFields.searchFilters.displayIssuesAndTypesFilters":"true"}}},openTerms:"use search manager box"},embase:{id:"embase",title:"Embase",aliases:["embase","e","eb"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:'<span msg="NO_OPTIONAL_WILDCARD">?</span>'},{subject:/\$/g,value:'<span msg="NO_OPTIONAL_WILDCARD">*</span>'},{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">*</span>'}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":e.field?a+="("+n(e.nodes)+")"+("title"==e.field?":ti":"abstract"==e.field?":ab":"title+abstract"==e.field?":ti,ab":"title+abstract+other"==e.field?":ti,ab,de,tn":"floatingSubheading"==e.field?":lnk":"publicationType"==e.field?":it":"substance"==e.field?":tn":""):a+="("+n(e.nodes)+")";break;case"phrase":e.field?a+=polyglot.tools.quotePhrase(e,"embase")+("title"==e.field?":ti":"abstract"==e.field?":ab":"title+abstract"==e.field?":ti,ab":"title+abstract+other"==e.field?":ti,ab,de,tn":"floatingSubheading"==e.field?":lnk":"publicationType"==e.field?":it":"substance"==e.field?":tn":""):a+=polyglot.tools.quotePhrase(e,"embase");break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="NEAR/"+e.proximity;break;case"mesh":a+="'"+e.content+"'/"+(e.recurse?"exp":"de");break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"embase");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"GET",action:"http://www.embase.com.ezproxy.bond.edu.au/search",fields:{sb:"y",search_query:e.replace(/\n+/g," ")}}},openTerms:"any search box"},wos:{id:"wos",title:"Web of Science",aliases:["webofscience","w","wos","websci"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:"$"},{subject:/\$/g,value:"*"},{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">*</span>'}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":a+="("+n(e.nodes)+")";break;case"phrase":a+=polyglot.tools.quotePhrase(e,"wos");break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="NEAR/"+e.proximity;break;case"mesh":a+=polyglot.tools.quotePhrase(e,"wos");break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"wos");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://apps.webofknowledge.com.ezproxy.bond.edu.au/UA_GeneralSearch.do",fields:{fieldCount:"1",action:"search",product:"UA",search_mode:"GeneralSearch",SID:"W15WDD6M2xkKPbfGfGY",max_field_count:"25",max_field_notice:"Notice: You cannot add another field.",input_invalid_notice:"Search Error: Please enter a search term.",exp_notice:"Search Error: Patent search term could be found in more than one family (unique patent number required for Expand option) ",input_invalid_notice_limits:" <br/>Note: Fields displayed in scrolling boxes must be combined with at least one other search field.",sa_params:"UA||W15WDD6M2xkKPbfGfGY|http://apps.webofknowledge.com.ezproxy.bond.edu.au|'",formUpdated:"true","value(input1)":e,"value(select1)":"TS",x:"798",y:"311","value(hidInput1)":null,limitStatus:"collapsed",ss_lemmatization:"On",ss_spellchecking:"Suggest",SinceLastVisit_UTC:null,SinceLastVisit_DATE:null,period:"Range Selection",range:"ALL",startYear:"1900",endYear:(new Date).getYear(),update_back2search_link_param:"yes",ssStatus:"display:none",ss_showsuggestions:"ON",ss_query_language:"auto",ss_numDefaultGeneralSearchFields:"1",rs_sort_by:"PY.D;LD.D;SO.A;VL.D;PG.A;AU.A"}}},openTerms:"any search box"},cinahl:{id:"cinahl",title:"CINAHL",aliases:["cinahl","ci","cnal"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">*</span>'},{subject:/\?/g,value:"#"},{subject:/\$/g,value:"*"}]);return function n(r){return r.map(function(t,e){var a="";switch(t.type){case"group":t.field&&(t.nodes=polyglot.tools.visit(t.nodes,["phrase"],function(e){return e.field=t.field})),a+="("+n(t.nodes)+")";break;case"phrase":t.field&&"title+abstract"==t.field?a+="TI "+polyglot.tools.quotePhrase(t,"cinahl")+" OR AB "+polyglot.tools.quotePhrase(t,"cinahl"):t.field?a+=_.trimStart(("title"==t.field?"TI":"abstract"==t.field?"AB":"floatingSubheading"==t.field?"MW":"publicationType"==t.field?"PT":"substance"==t.field?"MW":"")+" "+polyglot.tools.quotePhrase(t,"cinahl")):a+=polyglot.tools.quotePhrase(t,"cinahl");break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="N"+t.proximity;break;case"mesh":a+='(MH "'+t.content+(t.recurse?"+":"")+'")';break;case"raw":a+=t.content;break;case"template":a+=polyglot.tools.resolveTemplate(t.content,"cinahl");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+t.type)}return a+("raw"==t.type||e==r.length-1||e<r.length-1&&r[e+1]&&r[e+1].type&&"raw"==r[e+1].type||0<e&&r[e-1]&&r[e-1].type&&"raw"==r[e-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://web.a.ebscohost.com.ezproxy.bond.edu.au/ehost/resultsadvanced",fields:{bquery:e}}},openTerms:"any search box"},psycinfo:{id:"psycinfo",title:"PsycInfo",aliases:["p","pi"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:"?"},{subject:/\$/g,value:"*"}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":a+="("+n(e.nodes)+")";break;case"phrase":e.field?a+=e.content+("title"==e.field?".ti":"abstract"==e.field?".ab":"title+abstract"==e.field?".ti,ab":"title+abstract+other"==e.field?".mp.":"floatingSubheading"==e.field?".hw":"publicationType"==e.field?".pt":"substance"==e.field?".hw":""):a+=e.content;break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="ADJ"+e.proximity;break;case"mesh":a+=polyglot.tools.quotePhrase(e,"psycinfo");break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"psycinfo");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://ovidsp.tx.ovid.com.ezproxy.bond.edu.au/sp-3.17.0a/ovidweb.cgi",fields:{textBox:e}}},openTerms:"any search box"},scopus:{id:"scopus",title:"Scopus",aliases:["s","so"],compile:function(e,t){_.defaults(t,{replaceWildcards:!0}).replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/\?/g,value:'<span msg="NO_OPTIONAL_WILDCARD">?</span>'},{subject:/\$/g,value:'<span msg="NO_OPTIONAL_WILDCARD">*</span>'},{subject:/#/g,value:'<span msg="NO_SINGLE_WILDCARD">?</span>'}]);return function n(r){return r.map(function(e,t){var a="";switch(e.type){case"group":a+="("+n(e.nodes)+")";break;case"phrase":e.field?a+="title"==e.field?'TITLE("'+e.content+'")':"abstract"==e.field?'ABS("'+e.content+'")':"title+abstract"==e.field?'TITLE-ABS("'+e.content+'")':"title+abstract+other"==e.field?'TITLE-ABS-KEY("'+e.content+'")':"floatingSubheading"==e.field?'INDEXTERMS("'+e.content+'")':"publicationType"==e.field?'DOCTYPE("'+e.content+'")':"substance"==e.field?'CHEM("'+e.content+'")':'"'+e.content+'"':a+='"'+e.content+'"';break;case"joinAnd":a+="AND";break;case"joinOr":a+="OR";break;case"joinNot":a+="NOT";break;case"joinNear":a+="W/"+e.proximity;break;case"mesh":a+='INDEXTERMS("'+e.content+'")';break;case"raw":a+=e.content;break;case"template":a+=polyglot.tools.resolveTemplate(e.content,"scopus");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a+("raw"==e.type||t==r.length-1||t<r.length-1&&r[t+1]&&r[t+1].type&&"raw"==r[t+1].type||0<t&&r[t-1]&&r[t-1].type&&"raw"==r[t-1].type?"":" ")}).join("")}(e)},open:function(e){return{method:"POST",action:"http://ovidsp.tx.ovid.com.ezproxy.bond.edu.au/sp-3.17.0a/ovidweb.cgi",fields:{textBox:e}}},openTerms:"use advanced search box"},lexicalTreeJSON:{id:"lexicalTreeJSON",title:"Lexical Tree (JSON)",aliases:["debug"],debugging:!0,compile:function(e,t){return e}},lexicalTreeHuman:{id:"lexicalTreeHuman",title:"Lexical Tree (Human Readable)",aliases:["debug"],debugging:!0,compile:function(e,t){return function a(e,n){return e.map(function(e){var t=_.repeat("  ",n)+"- ";switch(e.type){case"group":t+="GROUP"+(e.field?" (field="+e.field+"):":":")+"\n",t+=a(e.nodes,n+1);break;case"phrase":t+='"'+e.content+'"'+(e.field?" (field="+e.field+")":"");break;case"joinNear":t+="NEAR"+e.proximity;break;case"joinAnd":t+="AND";break;case"joinOr":t+="OR";break;case"joinNot":t+="NOT";break;case"mesh":t+='MESH("'+e.content+'")';break;case"raw":t+="RAW("+e.content.length+" bytes)";break;case"template":t+="TEMPLATE("+e.content+")";break;case"comment":t+='COMMENT("'+e.content+'")';break;default:throw new Error("Unsupported object tree type: "+e.type)}return t}).join("\n")}(e,0)}},mongodb:{id:"mongodb",title:"MongoDB Query Format",aliases:["mongo"],debugging:!0,compile:function(e,t){var r=_.defaults(t,{replaceWildcards:!0,translatePhraseField:function(e){return{title:e}},meshField:"mesh",translateTitleAbstract:function(e){return{$or:[{title:e},{abstract:e}]}}});r.replaceWildcards&&polyglot.tools.replaceContent(e,["phrase"],[{subject:/[\?\$]/g,value:"*"}]);return function n(e){return _(e).map(function(e,t){var a={};switch(e.type){case"group":e.field&&"title+abstract"==e.field?a["TITLE+ABSTRACT"]=n(e.nodes):e.field?a[e.field]=n(e.nodes):a=r.translatePhraseField(n(e.nodes));break;case"phrase":e.field&&"title+abstract"==e.field?a=r.translateTitleAbstract(e.content):e.field?a[e.field]=e.content:a=r.translatePhraseField(e.content);break;case"joinNear":case"joinAnd":a={$and:[]};break;case"joinOr":a={$or:[]};break;case"joinNot":a={$not:{}};break;case"mesh":a[r.meshField]={$in:[e.content]};break;case"raw":break;case"template":a=polyglot.tools.resolveTemplate(e.content,"mongodb");break;case"comment":break;default:throw new Error("Unsupported object tree type: "+e.type)}return a}).thru(function(e){return _.isArray(e)&&1==e.length&&(e=e[0]),e}).value()}(e)}}},tools:{replaceContent:function(e,t,a){return polyglot.tools.visit(e,t,function(t){t.content&&a.forEach(function(e){t.content=t.content.replace(e.subject,e.value)})}),e},visit:function(a,s,i){var o=[];return function n(e,r){e.forEach(function(e,t){var a=r.concat(t);s&&!_.includes(s,e.type)||"DEL"===i(e,a)&&o.push(a),"group"==e.type&&n(e.nodes,a.concat(["nodes"]))})}(a,[]),o.reverse().forEach(function(e){var t=e.pop();delete(e.length?_.get(a,e):a)[t]}),a},resolveTemplate:function(e,t){return polyglot.templates[e]?polyglot.templates[e].engines[t]?polyglot.templates[e].engines[t]:polyglot.templates[e].engines.default?polyglot.translate(polyglot.templates[e].engines.default,t):"":"UNKNOWN-TEMPLATE:"+e},quotePhrase:function(e,t){var a=_.trimEnd(e.content);return/\s/.test(a)?'"'+a+'"':a},renestConditions:function(e){return _.isArray(e)?e.reduce(function(e,t,a,n){var r=_(t).keys().first();if("$or"==r||"$and"==r){var s={};s[r]=[e.pop(),n.splice(a+1,1)[0]],e.push(s)}else e.push(t);return e},[]):e},combineConditions:function(s,e){var o=_.defaults(e,{depth:10}),l=[];return function r(s){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];_.forEach(s,function(e,t){if(_.isObject(e)){var a=_(s).keys().first();if(1<i.length&&("$or"==a||"$and"==a)){var n=_.findLast(l,function(e){return"$and"==e.key||"$or"==e.key});n&&n.key!=a||l.push({key:a,path:i})}if(o.depth&&i.length>o.depth)return;r(e,i.concat([t]))}})}(s),l.forEach(function(e){var t=_.get(s,e.path.slice(0,-1)),a=_.get(s,e.path.concat([e.key]));if(a&&t&&t.length){var n=t[1];n&&a.push(n);var r=_(e.path).slice(0,-1).findLast(_.isString);r&&"$and"==r&&"$or"==e.key&&(a={$or:a}),_.set(s,e.path.slice(0,-1),a)}}),s}}};